<!DOCTYPE html>
<meta charset="utf-8">
<style>

    svg {
        font: 15px sans-serif;
    }

    .background path {
        fill: none;
        stroke: #ccc;
        stroke-opacity: .4;
        shape-rendering: crispEdges;
    }

    .foreground path {
        fill: none;
        stroke: blue;
        stroke-opacity: .7;
    }

    .brush .extent {
        fill-opacity: .3;
        stroke: #fff;
        shape-rendering: crispEdges;
    }

    .axis line, .axis path {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .axis text {
        text-shadow: 0 1px 0 #fff;
    }

</style>
<body>
<div style="margin-left: 400px;font-weight: bold;font-size: 20px"><p>10支A股名称的百度指数</p></div>
<script src="d3.js"></script>
<script>

    var name_map = [];
    name_map = ["20110109","20110116","20110123","20110130","20110206","20110213","20110220","20110227","20110306","20110313","20110320","20110327","20110403","20110410","20110417","20110424","20110501","20110508","20110515","20110522","20110529","20110605","20110612","20110619","20110626","20110703","20110710","20110717","20110724","20110731","20110807","20110814","20110821","20110828","20110904","20110911","20110918","20110925","20111002","20111009","20111016","20111023","20111030","20111106","20111113","20111120","20111127","20111204","20111211","20111218","20111225","20120101","20120108","20120115","20120122","20120129","20120205","20120212","20120219","20120226","20120304","20120311","20120318","20120325","20120401","20120408","20120415","20120422","20120429","20120506","20120513","20120520","20120527","20120603","20120610","20120617","20120624","20120701","20120708","20120715","20120722","20120729","20120805","20120812","20120819","20120826","20120902","20120909","20120916","20120923","20120930","20121007","20121014","20121021","20121028","20121104","20121111","20121118","20121125","20121202","20121209","20121216","20121223","20121230","20130106","20130113","20130120","20130127","20130203","20130210","20130217","20130224","20130303","20130310","20130317","20130324","20130331","20130407","20130414","20130421","20130428","20130505","20130512","20130519","20130526","20130602","20130609","20130616","20130623","20130630","20130707","20130714","20130721","20130728","20130804","20130811","20130818","20130825","20130901","20130908","20130915","20130922","20130929","20131006","20131013","20131020","20131027","20131103","20131110","20131117","20131124","20131201","20131208","20131215","20131222","20131229","20140105","20140112","20140119","20140126","20140202","20140209","20140216","20140223","20140302","20140309","20140316","20140323","20140330","20140406","20140413","20140420","20140427","20140504","20140511","20140518","20140525","20140601","20140608","20140615","20140622","20140629"

    ];

    var m = [30, 10, 10, 10],
            w = 960 - m[1] - m[3]+450,
            h = 500 - m[0] - m[2];

    var x = d3.scale.ordinal().rangePoints([0, w], .5),
            y = {};

    var line = d3.svg.line(),
            axis = d3.svg.axis().orient("left"),
            background,
            foreground;

    var svg = d3.select("body").append("svg")
            .attr("width", w + m[1] + m[3])
            .attr("height", h + m[0] + m[2])
            .append("g")
            .attr("transform", "translate(" + m[3] + "," + m[0] +")");
    //alert(1)
    d3.csv("百度指数.csv", function(cities) {
        //alert(cities.length)
        // Extract the list of dimensions and create a scale for each.
        x.domain(dimensions = d3.keys(cities[0]).filter(function(d) {

            if(d=="name")return y[d]=d3.scale.ordinal().rangePoints([0, h]).domain(cities.map(function(t) { return t[d]; }).sort());
            return d != "name" && (y[d] = d3.scale.linear()
                            .domain(d3.extent(cities, function(p) { return +p[d]; }))
                            .range([h, 0]));
        }));

        // Add grey background lines for context.
        background = svg.append("g")
                .attr("class", "background")
                .selectAll("path")
                .data(cities)
                .enter().append("path")
                .attr("d", path);

        // Add blue foreground lines for focus.
        foreground = svg.append("g")
                .attr("class", "foreground")
                .selectAll("path")
                .data(cities)
                .enter().append("path")
                .attr("d", path);

        // Add a group element for each dimension.
        var g = svg.selectAll(".dimension")
                .data(dimensions)
                .enter().append("g")
                .attr("class", "dimension")
                .attr("transform", function(d) { return "translate(" + x(d) + ")"; });
        //.attr("style","width:200px");
        // Add an axis and title.
        g.append("g")
                .attr("class", "axis")
                .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
                .append("text")
                .attr("text-anchor", "middle")
                .attr("y", -9)
                .text(String);

        // Add and store a brush for each axis.
        g.append("g")
                .attr("class", "brush")
                .each(function(d) { d3.select(this).call(y[d].brush = d3.svg.brush().y(y[d]).on("brush", brush)); })
                .selectAll("rect")
                .attr("x", -8)
                .attr("width", 16);
    });

    // Returns the path for a given data point.
    function path(d) {
        return line(dimensions.map(function(p) { return [x(p), y[p](d[p])]; }));
    }

    // Handles a brush event, toggling the display of foreground lines.
    function brush() {
        var texts_ = document.getElementsByTagName("text");
        for(var j=0;j<texts_.length;j++){
            texts_[j].setAttribute("fill",null);
        }
        var actives = dimensions.filter(function(p) { return !y[p].brush.empty(); }),
                extents = actives.map(function(p) { return y[p].brush.extent(); });
        foreground.style("display", function(d) {
            return actives.every(function(p, i) {
                if(p == "name"){
                    var temp;
                    for(var j=0;j<name_map.length;j++){
                        if(name_map[j] == d[p])
                        {temp = j+1;break;}
                    }
                    if(extents[i][0] <= temp*460/50 && temp*460/50 <= extents[i][1]){
                        var texts = document.getElementsByTagName("text");
                        for(var j=0;j<texts.length;j++){
                            if(texts[j].innerHTML == d["name"]){
                                texts[j].setAttribute("fill","blue");
                            }
                        }

                    }
                    else{
                        var texts = document.getElementsByTagName("text");
                        for(var j=0;j<texts.length;j++){
                            if(texts[j].innerHTML == d["name"]){
                                texts[j].setAttribute("fill",null);
                            }
                        }
                    }
                    return extents[i][0] <= temp*460/50 && temp*460/50 <= extents[i][1];
                }
                if(extents[i][0] <= d[p] && d[p] <= extents[i][1]){
                    var texts = document.getElementsByTagName("text");
                    for(var j=0;j<texts.length;j++){
                        //texts[j].setAttribute("fill",null);
                        if(texts[j].innerHTML == d["name"]){
                            texts[j].setAttribute("fill","blue");
                        }
                    }

                }
                else{
                    var texts = document.getElementsByTagName("text");
                    for(var j=0;j<texts.length;j++){
                        if(texts[j].innerHTML == d["name"]){
                            texts[j].setAttribute("fill",null);
                        }
                    }
                }
                return extents[i][0] <= d[p] && d[p] <= extents[i][1];
            }) ? null : "none";
        });
    }
</script>
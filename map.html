
<html>  
  <head>  
        <meta charset="utf-8">  
        <title>Map</title>  
  </head> 
<style>
	#tooltip {
			position: absolute;
			width: 150px;
			height: auto;
			padding: 10px;
			background-color: #cfe2f3;
			-webkit-border-radius: 10px;
			-moz-border-radius: 10px;
			border-radius: 10px;
			-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			pointer-events: none;
		}
		#tooltip.hidden {
			display: none;
		}
		#tooltip p {
			margin: 0;
			font-family: sans-serif;
			font-size: 16px;
			line-height: 20px;
		}
</style>
<body>
	<div id="tooltip" class="hidden">
			<p><strong>省份：</strong><span id="province">100</span></p>
			<p><strong>年份：</strong><span id="year">100</span></p>
			<p><strong>总和：</strong><span id="sum">100</span></p>
			<p><strong>第一产业：</strong><span id="industry1">100</span></p>
			<p><strong>第二产业：</strong><span id="industry2">100</span></p>
			<p><strong>第三产业：</strong><span id="industry3">100</span></p>
	</div>

<script src="js/d3.js"></script>
<script src="js/timeaxis.js"></script>
<script src="js/pie.js"></script>
<script src="js/jquery.min.js"></script>
<script>


	var width  = 1000;
	var height = 1000;
	var nodes = [];
	
	var svg = d3.select("body").append("svg")
	    .attr("width", width)
	    .attr("height", height);
	var mapg = svg.append("g")
	    	.attr("transform", "translate(0,0)");
	
	var projection = d3.geo.mercator()
						.center([107, 31])
						.scale(850)
    					.translate([width/2, height/2]);
	
	var path = d3.geo.path().projection(projection);
	
	//var color = d3.scale.category20();
	
	d3.json("json/china.json", function(error, root) {
		
		if (error){
			return console.error(error);
		} 
			
		console.log(root.features);

		mapg.selectAll("path")
			.data(root.features)
			.enter()
			.append("path")
			.attr("stroke","#000")
			.attr("stroke-width",1)
			.attr("fill", function(d,i){
				//return color(i);
				//return "#D1EEEE";
				return "#FFEFD5";
			})
			.attr("d", path )
			.on("mouseover",function(d,i){
                //d3.select(this).attr("fill","yellow");
                //d.properties.name;//获取区域名称
                //alert(d.properties.name);
                //d.properties.id;//获取区域id
            })
            .on("mouseout",function(d,i){
                //d3.select(this).attr("fill",color(i));
            });


		
		
		//获取中心点坐标
		root.features.forEach(function(d, i) {
			var centroid = path.centroid(d);
			centroid.x = centroid[0];
			centroid.y = centroid[1];
			centroid.id = d.properties.id;
			centroid.name = d.properties.name
			centroid.feature = d;
			nodes.push(centroid);
		});

		
		//加载时间数据
		/*d3.json("json/1995.json", function(error, root){
			year1995 = root;//读取年份数据
			nodes.forEach(function(d){
				var name = year1995[d.name];
				pie(mapg, name, d);
			});
		});*/

		//为每个区域画饼图
		/*nodes.forEach(function(d){
			pie(mapg, d);
		});*/

        //给每个坐标添加一个原点
        /*svg.selectAll("circle")
			.data(nodes)
			.enter()
			.append("circle")
			.attr("cx", function(d) {
				return d[0];
			})
			.attr("cy", function(d) {
				return d[1];
			})
			.attr("r", 5)
			.style("fill", "yellow")
			.style("opacity", 0.75);*/

		//d3.json("json/china.json", function(error,root){});
		d3.json("json/data/year.json", function(error, root){
			drawAxisTime(svg, width, height, root.years, nodes);//读取年份数据
			//第一次进来点击第一年的数据
			circlemouseover(root.years[0]);
			//$("#"+root.years[0]).click();
		});
		
	});
</script>
	
</body>  
</html>  